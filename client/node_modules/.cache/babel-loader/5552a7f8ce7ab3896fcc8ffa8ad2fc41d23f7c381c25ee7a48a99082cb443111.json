{"ast":null,"code":"// store/ProductStore.js\nimport { makeAutoObservable } from 'mobx';\nimport { getAllSellers, getSellerById, getSellerProducts, getSellerByUserId } from '../http/sellerAPI';\nimport { getProductsBySeller, searchProducts } from '../http/productAPI';\nclass ProductStore {\n  constructor() {\n    this.products = [];\n    this.totalCount = 0;\n    this.limit = 9;\n    this.page = 1;\n    this.selectedCity = '';\n    this.isLoading = false;\n    this.error = null;\n    this.cities = [];\n    this.currentSearchQuery = '';\n    this.currentFilters = null;\n    // НОВЫЕ СВОЙСТВА ДЛЯ ПРОДАВЦОВ\n    this.sellers = [];\n    this.selectedSeller = null;\n    this.sellerProducts = [];\n    this.isSellersLoading = false;\n    this.sellersTotalCount = 0;\n    this.sellersPage = 1;\n    this.sellersLimit = 12;\n    makeAutoObservable(this);\n    this.initializeCity();\n    this.initializeFilters();\n  }\n  initializeCity() {\n    const savedCity = sessionStorage.getItem('city');\n    if (savedCity) {\n      this.selectedCity = savedCity;\n    }\n  }\n  initializeFilters() {\n    const savedFilters = sessionStorage.getItem('productFilters');\n    if (savedFilters) {\n      try {\n        this.currentFilters = JSON.parse(savedFilters);\n      } catch (error) {\n        console.error('Ошибка при загрузке фильтров:', error);\n        this.currentFilters = null;\n      }\n    }\n  }\n\n  // СУЩЕСТВУЮЩИЕ МЕТОДЫ\n  setProducts(products) {\n    this.products = products;\n  }\n  setTotalCount(count) {\n    this.totalCount = count;\n  }\n  setPage(page) {\n    this.page = page;\n  }\n  setSelectedCity(city) {\n    this.selectedCity = city;\n    sessionStorage.setItem('city', city);\n  }\n  setLoading(loading) {\n    this.isLoading = loading;\n  }\n  setError(error) {\n    this.error = error;\n  }\n  setCities(cities) {\n    this.cities = cities;\n  }\n  setCurrentSearchQuery(query) {\n    this.currentSearchQuery = query;\n  }\n  setCurrentFilters(filters) {\n    this.currentFilters = filters;\n    try {\n      sessionStorage.setItem('productFilters', JSON.stringify(filters));\n    } catch (error) {\n      console.error('Ошибка при сохранении фильтров:', error);\n    }\n  }\n\n  // НОВЫЕ МЕТОДЫ ДЛЯ ПРОДАВЦОВ\n  setSellers(sellers) {\n    this.sellers = sellers;\n  }\n  setSelectedSeller(seller) {\n    this.selectedSeller = seller;\n  }\n  setSellerProducts(products) {\n    this.sellerProducts = products;\n  }\n  setIsSellersLoading(loading) {\n    this.isSellersLoading = loading;\n  }\n  setSellersTotalCount(count) {\n    this.sellersTotalCount = count;\n  }\n  setSellersPage(page) {\n    this.sellersPage = page;\n  }\n\n  // ГЕТТЕРЫ\n  getCurrentFilters() {\n    return this.currentFilters;\n  }\n  get currentCity() {\n    return this.selectedCity || sessionStorage.getItem('city') || 'Выберите город';\n  }\n  get hasSelectedCity() {\n    return !!this.selectedCity;\n  }\n  get hasActiveSearch() {\n    return !!this.currentSearchQuery;\n  }\n  get hasActiveFilters() {\n    return this.currentFilters && (this.currentFilters.minPrice || this.currentFilters.maxPrice || this.currentFilters.sortBy !== 'newest' || this.currentFilters.categoryId || this.currentFilters.characteristics && Object.keys(this.currentFilters.characteristics).length > 0 || this.currentFilters.excludeNoPrice);\n  }\n\n  // СУЩЕСТВУЮЩИЕ МЕТОДЫ ДЛЯ ПРОДУКТОВ\n  clearCurrentFilters() {\n    this.currentFilters = null;\n    sessionStorage.removeItem('productFilters');\n  }\n  async fetchCities() {\n    try {\n      const response = await fetch('http://localhost:5000/api/prod/cities');\n      if (response.ok) {\n        const data = await response.json();\n        this.setCities(data);\n        return data;\n      }\n    } catch (error) {\n      console.error('Ошибка при получении городов:', error);\n    }\n    return [];\n  }\n  async fetchProducts(filters = {}) {\n    this.setLoading(true);\n    this.setError(null);\n    try {\n      let url = `http://localhost:5000/api/prod?limit=1000`;\n      const queryParams = new URLSearchParams();\n      if (this.selectedCity) {\n        queryParams.append('city', this.selectedCity);\n      }\n      if (filters.typeId) {\n        queryParams.append('typeId', filters.typeId);\n      }\n      if (filters.sellerId) {\n        queryParams.append('sellerId', filters.sellerId);\n      }\n      const queryString = queryParams.toString();\n      if (queryString) {\n        url += `&${queryString}`;\n      }\n      console.log('Fetch URL:', url);\n      const response = await fetch(url);\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      const data = await response.json();\n      let allProducts = data.rows || data;\n      if (this.currentSearchQuery) {\n        const searchTerm = this.currentSearchQuery.toLowerCase().trim();\n        allProducts = allProducts.filter(product => product.name.toLowerCase().includes(searchTerm) || product.description && product.description.toLowerCase().includes(searchTerm) || product.price_text && product.price_text.toLowerCase().includes(searchTerm));\n      }\n      if (filters.categoryId) {\n        allProducts = allProducts.filter(product => product.type_id == filters.categoryId);\n      }\n      if (filters.characteristics && Object.keys(filters.characteristics).length > 0) {\n        allProducts = allProducts.filter(product => {\n          if (!product.info || !Array.isArray(product.info)) return false;\n          return Object.entries(filters.characteristics).every(([charTitle, charValues]) => {\n            const productChar = product.info.find(info => info.title === charTitle);\n            if (!productChar) return false;\n            return charValues.includes(productChar.description);\n          });\n        });\n      }\n      if (filters.minPrice) {\n        const minPrice = parseFloat(filters.minPrice);\n        allProducts = allProducts.filter(product => {\n          if (product.price === null || product.price === undefined || product.price === 0) {\n            return !filters.excludeNoPrice;\n          }\n          return product.price >= minPrice;\n        });\n      }\n      if (filters.maxPrice) {\n        const maxPrice = parseFloat(filters.maxPrice);\n        allProducts = allProducts.filter(product => {\n          if (product.price === null || product.price === undefined || product.price === 0) {\n            return !filters.excludeNoPrice;\n          }\n          return product.price <= maxPrice;\n        });\n      }\n      if (filters.excludeNoPrice && !filters.minPrice && !filters.maxPrice) {\n        allProducts = allProducts.filter(product => product.price !== null && product.price !== undefined && product.price > 0);\n      }\n      if (filters.sortBy) {\n        switch (filters.sortBy) {\n          case 'price_asc':\n            allProducts.sort((a, b) => {\n              const priceA = a.price || 0;\n              const priceB = b.price || 0;\n              return priceA - priceB;\n            });\n            break;\n          case 'price_desc':\n            allProducts.sort((a, b) => {\n              const priceA = a.price || 0;\n              const priceB = b.price || 0;\n              return priceB - priceA;\n            });\n            break;\n          case 'name_asc':\n            allProducts.sort((a, b) => (a.name || '').localeCompare(b.name || ''));\n            break;\n          case 'name_desc':\n            allProducts.sort((a, b) => (b.name || '').localeCompare(a.name || ''));\n            break;\n          case 'newest':\n          default:\n            allProducts.sort((a, b) => new Date(b.createdAt || 0) - new Date(a.createdAt || 0));\n            break;\n        }\n      }\n      const startIndex = (this.page - 1) * this.limit;\n      const endIndex = startIndex + this.limit;\n      const paginatedProducts = allProducts.slice(startIndex, endIndex);\n      this.setProducts(paginatedProducts);\n      this.setTotalCount(allProducts.length);\n    } catch (error) {\n      console.error('Ошибка при получении продуктов:', error);\n      this.setError('Не удалось загрузить товары');\n      this.setProducts([]);\n      this.setTotalCount(0);\n    } finally {\n      this.setLoading(false);\n    }\n  }\n  async fetchProductsByCity(city) {\n    this.setSelectedCity(city);\n    this.setCurrentSearchQuery('');\n    await this.fetchProducts();\n  }\n  async searchProducts(searchQuery, filters = {}) {\n    this.setCurrentSearchQuery(searchQuery);\n    const finalFilters = {\n      ...this.currentFilters,\n      ...filters\n    };\n    if (Object.keys(finalFilters).length > 0) {\n      this.setCurrentFilters(finalFilters);\n    }\n    await this.fetchProducts(finalFilters);\n  }\n  async changeCity(city) {\n    await this.fetchProductsByCity(city);\n  }\n  async clearSearch() {\n    this.setCurrentSearchQuery('');\n    await this.fetchProducts(this.currentFilters || {});\n  }\n  async resetFilters() {\n    this.setSelectedCity('');\n    this.setCurrentSearchQuery('');\n    this.clearCurrentFilters();\n    sessionStorage.removeItem('city');\n    await this.fetchProducts();\n  }\n  async applyFilters(filters) {\n    this.setCurrentFilters(filters);\n    await this.fetchProducts(filters);\n  }\n\n  // НОВЫЕ МЕТОДЫ ДЛЯ РАБОТЫ С ПРОДАВЦАМИ\n  async fetchSellers(city = '', page = 1, limit = 12) {\n    this.setIsSellersLoading(true);\n    try {\n      const params = {\n        page,\n        limit\n      };\n      if (city) params.city = city;\n      const response = await getAllSellers(params);\n      this.setSellers(response.rows || response);\n      this.setSellersTotalCount(response.count || response.length);\n      return response;\n    } catch (error) {\n      console.error('Ошибка при загрузке продавцов:', error);\n      this.setError('Не удалось загрузить список магазинов');\n      throw error;\n    } finally {\n      this.setIsSellersLoading(false);\n    }\n  }\n\n  // store/ProductStore.js\n  async fetchSellerById(sellerId) {\n    console.log('fetchSellerById called with:', sellerId);\n    this.setIsSellersLoading(true);\n    try {\n      const seller = await getSellerById(sellerId);\n      console.log('Seller fetched:', seller);\n      this.setSelectedSeller(seller);\n      return seller;\n    } catch (error) {\n      console.error('Ошибка при загрузке продавца:', error);\n      console.error('Error details:', error.response);\n      this.setError('Не удалось загрузить информацию о магазине');\n      throw error;\n    } finally {\n      this.setIsSellersLoading(false);\n    }\n  }\n  async fetchSellerProducts(sellerId) {\n    console.log('fetchSellerProducts called with:', sellerId);\n    try {\n      const products = await getSellerProducts(sellerId);\n      console.log('Seller products fetched:', products);\n      this.setSellerProducts(products);\n      return products;\n    } catch (error) {\n      console.error('Ошибка при загрузке товаров продавца:', error);\n\n      // Попробуем альтернативный метод\n      try {\n        console.log('Trying alternative method...');\n        const allProducts = await fetchProducts();\n        const sellerProducts = allProducts.filter(product => product.seller_id == sellerId);\n        console.log('Filtered seller products:', sellerProducts);\n        this.setSellerProducts(sellerProducts);\n        return sellerProducts;\n      } catch (fallbackError) {\n        console.error('Fallback method also failed:', fallbackError);\n        this.setError('Не удалось загрузить товары магазина');\n        throw fallbackError;\n      }\n    }\n  }\n  async fetchSellerProducts(sellerId) {\n    try {\n      const products = await getSellerProducts(sellerId);\n      this.setSellerProducts(products);\n      return products;\n    } catch (error) {\n      console.error('Ошибка при загрузке товаров продавца:', error);\n\n      // Если отдельный endpoint не работает, используем общий с фильтром\n      try {\n        const products = await getProductsBySeller(sellerId);\n        this.setSellerProducts(products.rows || products);\n        return products;\n      } catch (fallbackError) {\n        this.setError('Не удалось загрузить товары магазина');\n        throw fallbackError;\n      }\n    }\n  }\n  async searchSellers(searchQuery) {\n    this.setIsSellersLoading(true);\n    try {\n      var _allSellers$rows;\n      // Фильтруем продавцов по имени или описанию\n      const allSellers = await getAllSellers();\n      const filteredSellers = ((_allSellers$rows = allSellers.rows) === null || _allSellers$rows === void 0 ? void 0 : _allSellers$rows.filter(seller => seller.name.toLowerCase().includes(searchQuery.toLowerCase()) || seller.description && seller.description.toLowerCase().includes(searchQuery.toLowerCase()))) || [];\n      this.setSellers(filteredSellers);\n      return filteredSellers;\n    } catch (error) {\n      console.error('Ошибка при поиске продавцов:', error);\n      throw error;\n    } finally {\n      this.setIsSellersLoading(false);\n    }\n  }\n  clearSeller() {\n    this.setSelectedSeller(null);\n    this.setSellerProducts([]);\n  }\n  clearSellers() {\n    this.setSellers([]);\n    this.setSelectedSeller(null);\n    this.setSellerProducts([]);\n    this.setSellersPage(1);\n  }\n}\nexport const productStore = new ProductStore();","map":{"version":3,"names":["makeAutoObservable","getAllSellers","getSellerById","getSellerProducts","getSellerByUserId","getProductsBySeller","searchProducts","ProductStore","constructor","products","totalCount","limit","page","selectedCity","isLoading","error","cities","currentSearchQuery","currentFilters","sellers","selectedSeller","sellerProducts","isSellersLoading","sellersTotalCount","sellersPage","sellersLimit","initializeCity","initializeFilters","savedCity","sessionStorage","getItem","savedFilters","JSON","parse","console","setProducts","setTotalCount","count","setPage","setSelectedCity","city","setItem","setLoading","loading","setError","setCities","setCurrentSearchQuery","query","setCurrentFilters","filters","stringify","setSellers","setSelectedSeller","seller","setSellerProducts","setIsSellersLoading","setSellersTotalCount","setSellersPage","getCurrentFilters","currentCity","hasSelectedCity","hasActiveSearch","hasActiveFilters","minPrice","maxPrice","sortBy","categoryId","characteristics","Object","keys","length","excludeNoPrice","clearCurrentFilters","removeItem","fetchCities","response","fetch","ok","data","json","fetchProducts","url","queryParams","URLSearchParams","append","typeId","sellerId","queryString","toString","log","Error","status","allProducts","rows","searchTerm","toLowerCase","trim","filter","product","name","includes","description","price_text","type_id","info","Array","isArray","entries","every","charTitle","charValues","productChar","find","title","parseFloat","price","undefined","sort","a","b","priceA","priceB","localeCompare","Date","createdAt","startIndex","endIndex","paginatedProducts","slice","fetchProductsByCity","searchQuery","finalFilters","changeCity","clearSearch","resetFilters","applyFilters","fetchSellers","params","fetchSellerById","fetchSellerProducts","seller_id","fallbackError","searchSellers","_allSellers$rows","allSellers","filteredSellers","clearSeller","clearSellers","productStore"],"sources":["D:/nkurs/client/src/store/ProductStore.js"],"sourcesContent":["// store/ProductStore.js\r\nimport { makeAutoObservable } from 'mobx';\r\nimport { \r\n    getAllSellers, \r\n    getSellerById, \r\n    getSellerProducts,\r\n    getSellerByUserId \r\n} from '../http/sellerAPI';\r\nimport { \r\n    getProductsBySeller,\r\n    searchProducts \r\n} from '../http/productAPI';\r\n\r\nclass ProductStore {\r\n    products = [];\r\n    totalCount = 0;\r\n    limit = 9;\r\n    page = 1;\r\n    selectedCity = '';\r\n    isLoading = false;\r\n    error = null;\r\n    cities = [];\r\n    currentSearchQuery = '';\r\n    currentFilters = null;\r\n    \r\n    // НОВЫЕ СВОЙСТВА ДЛЯ ПРОДАВЦОВ\r\n    sellers = [];\r\n    selectedSeller = null;\r\n    sellerProducts = [];\r\n    isSellersLoading = false;\r\n    sellersTotalCount = 0;\r\n    sellersPage = 1;\r\n    sellersLimit = 12;\r\n\r\n    constructor() {\r\n        makeAutoObservable(this);\r\n        this.initializeCity();\r\n        this.initializeFilters();\r\n    }\r\n\r\n    initializeCity() {\r\n        const savedCity = sessionStorage.getItem('city');\r\n        if (savedCity) {\r\n            this.selectedCity = savedCity;\r\n        }\r\n    }\r\n\r\n    initializeFilters() {\r\n        const savedFilters = sessionStorage.getItem('productFilters');\r\n        if (savedFilters) {\r\n            try {\r\n                this.currentFilters = JSON.parse(savedFilters);\r\n            } catch (error) {\r\n                console.error('Ошибка при загрузке фильтров:', error);\r\n                this.currentFilters = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    // СУЩЕСТВУЮЩИЕ МЕТОДЫ\r\n    setProducts(products) {\r\n        this.products = products;\r\n    }\r\n\r\n    setTotalCount(count) {\r\n        this.totalCount = count;\r\n    }\r\n\r\n    setPage(page) {\r\n        this.page = page;\r\n    }\r\n\r\n    setSelectedCity(city) {\r\n        this.selectedCity = city;\r\n        sessionStorage.setItem('city', city);\r\n    }\r\n\r\n    setLoading(loading) {\r\n        this.isLoading = loading;\r\n    }\r\n\r\n    setError(error) {\r\n        this.error = error;\r\n    }\r\n\r\n    setCities(cities) {\r\n        this.cities = cities;\r\n    }\r\n\r\n    setCurrentSearchQuery(query) {\r\n        this.currentSearchQuery = query;\r\n    }\r\n\r\n    setCurrentFilters(filters) {\r\n        this.currentFilters = filters;\r\n        try {\r\n            sessionStorage.setItem('productFilters', JSON.stringify(filters));\r\n        } catch (error) {\r\n            console.error('Ошибка при сохранении фильтров:', error);\r\n        }\r\n    }\r\n\r\n    // НОВЫЕ МЕТОДЫ ДЛЯ ПРОДАВЦОВ\r\n    setSellers(sellers) {\r\n        this.sellers = sellers;\r\n    }\r\n\r\n    setSelectedSeller(seller) {\r\n        this.selectedSeller = seller;\r\n    }\r\n\r\n    setSellerProducts(products) {\r\n        this.sellerProducts = products;\r\n    }\r\n\r\n    setIsSellersLoading(loading) {\r\n        this.isSellersLoading = loading;\r\n    }\r\n\r\n    setSellersTotalCount(count) {\r\n        this.sellersTotalCount = count;\r\n    }\r\n\r\n    setSellersPage(page) {\r\n        this.sellersPage = page;\r\n    }\r\n\r\n    // ГЕТТЕРЫ\r\n    getCurrentFilters() {\r\n        return this.currentFilters;\r\n    }\r\n\r\n    get currentCity() {\r\n        return this.selectedCity || sessionStorage.getItem('city') || 'Выберите город';\r\n    }\r\n\r\n    get hasSelectedCity() {\r\n        return !!this.selectedCity;\r\n    }\r\n\r\n    get hasActiveSearch() {\r\n        return !!this.currentSearchQuery;\r\n    }\r\n\r\n    get hasActiveFilters() {\r\n        return this.currentFilters && (\r\n            this.currentFilters.minPrice || \r\n            this.currentFilters.maxPrice || \r\n            this.currentFilters.sortBy !== 'newest' || \r\n            this.currentFilters.categoryId || \r\n            (this.currentFilters.characteristics && Object.keys(this.currentFilters.characteristics).length > 0) || \r\n            this.currentFilters.excludeNoPrice\r\n        );\r\n    }\r\n\r\n    // СУЩЕСТВУЮЩИЕ МЕТОДЫ ДЛЯ ПРОДУКТОВ\r\n    clearCurrentFilters() {\r\n        this.currentFilters = null;\r\n        sessionStorage.removeItem('productFilters');\r\n    }\r\n\r\n    async fetchCities() {\r\n        try {\r\n            const response = await fetch('http://localhost:5000/api/prod/cities');\r\n            if (response.ok) {\r\n                const data = await response.json();\r\n                this.setCities(data);\r\n                return data;\r\n            }\r\n        } catch (error) {\r\n            console.error('Ошибка при получении городов:', error);\r\n        }\r\n        return [];\r\n    }\r\n\r\n    async fetchProducts(filters = {}) {\r\n        this.setLoading(true);\r\n        this.setError(null);\r\n        \r\n        try {\r\n            let url = `http://localhost:5000/api/prod?limit=1000`;\r\n            \r\n            const queryParams = new URLSearchParams();\r\n            \r\n            if (this.selectedCity) {\r\n                queryParams.append('city', this.selectedCity);\r\n            }\r\n            \r\n            if (filters.typeId) {\r\n                queryParams.append('typeId', filters.typeId);\r\n            }\r\n            if (filters.sellerId) {\r\n                queryParams.append('sellerId', filters.sellerId);\r\n            }\r\n            \r\n            const queryString = queryParams.toString();\r\n            if (queryString) {\r\n                url += `&${queryString}`;\r\n            }\r\n\r\n            console.log('Fetch URL:', url);\r\n\r\n            const response = await fetch(url);\r\n            \r\n            if (!response.ok) {\r\n                throw new Error(`HTTP error! status: ${response.status}`);\r\n            }\r\n            \r\n            const data = await response.json();\r\n            let allProducts = data.rows || data;\r\n\r\n            if (this.currentSearchQuery) {\r\n                const searchTerm = this.currentSearchQuery.toLowerCase().trim();\r\n                allProducts = allProducts.filter(product => \r\n                    product.name.toLowerCase().includes(searchTerm) ||\r\n                    (product.description && product.description.toLowerCase().includes(searchTerm)) ||\r\n                    (product.price_text && product.price_text.toLowerCase().includes(searchTerm))\r\n                );\r\n            }\r\n\r\n            if (filters.categoryId) {\r\n                allProducts = allProducts.filter(product => \r\n                    product.type_id == filters.categoryId\r\n                );\r\n            }\r\n\r\n            if (filters.characteristics && Object.keys(filters.characteristics).length > 0) {\r\n                allProducts = allProducts.filter(product => {\r\n                    if (!product.info || !Array.isArray(product.info)) return false;\r\n                    \r\n                    return Object.entries(filters.characteristics).every(([charTitle, charValues]) => {\r\n                        const productChar = product.info.find(info => info.title === charTitle);\r\n                        if (!productChar) return false;\r\n                        \r\n                        return charValues.includes(productChar.description);\r\n                    });\r\n                });\r\n            }\r\n\r\n            if (filters.minPrice) {\r\n                const minPrice = parseFloat(filters.minPrice);\r\n                allProducts = allProducts.filter(product => {\r\n                    if (product.price === null || product.price === undefined || product.price === 0) {\r\n                        return !filters.excludeNoPrice;\r\n                    }\r\n                    return product.price >= minPrice;\r\n                });\r\n            }\r\n\r\n            if (filters.maxPrice) {\r\n                const maxPrice = parseFloat(filters.maxPrice);\r\n                allProducts = allProducts.filter(product => {\r\n                    if (product.price === null || product.price === undefined || product.price === 0) {\r\n                        return !filters.excludeNoPrice;\r\n                    }\r\n                    return product.price <= maxPrice;\r\n                });\r\n            }\r\n\r\n            if (filters.excludeNoPrice && !filters.minPrice && !filters.maxPrice) {\r\n                allProducts = allProducts.filter(product => \r\n                    product.price !== null && \r\n                    product.price !== undefined && \r\n                    product.price > 0\r\n                );\r\n            }\r\n\r\n            if (filters.sortBy) {\r\n                switch (filters.sortBy) {\r\n                    case 'price_asc':\r\n                        allProducts.sort((a, b) => {\r\n                            const priceA = a.price || 0;\r\n                            const priceB = b.price || 0;\r\n                            return priceA - priceB;\r\n                        });\r\n                        break;\r\n                    case 'price_desc':\r\n                        allProducts.sort((a, b) => {\r\n                            const priceA = a.price || 0;\r\n                            const priceB = b.price || 0;\r\n                            return priceB - priceA;\r\n                        });\r\n                        break;\r\n                    case 'name_asc':\r\n                        allProducts.sort((a, b) => \r\n                            (a.name || '').localeCompare(b.name || '')\r\n                        );\r\n                        break;\r\n                    case 'name_desc':\r\n                        allProducts.sort((a, b) => \r\n                            (b.name || '').localeCompare(a.name || '')\r\n                        );\r\n                        break;\r\n                    case 'newest':\r\n                    default:\r\n                        allProducts.sort((a, b) => \r\n                            new Date(b.createdAt || 0) - new Date(a.createdAt || 0)\r\n                        );\r\n                        break;\r\n                }\r\n            }\r\n\r\n            const startIndex = (this.page - 1) * this.limit;\r\n            const endIndex = startIndex + this.limit;\r\n            const paginatedProducts = allProducts.slice(startIndex, endIndex);\r\n\r\n            this.setProducts(paginatedProducts);\r\n            this.setTotalCount(allProducts.length);\r\n            \r\n        } catch (error) {\r\n            console.error('Ошибка при получении продуктов:', error);\r\n            this.setError('Не удалось загрузить товары');\r\n            this.setProducts([]);\r\n            this.setTotalCount(0);\r\n        } finally {\r\n            this.setLoading(false);\r\n        }\r\n    }\r\n\r\n    async fetchProductsByCity(city) {\r\n        this.setSelectedCity(city);\r\n        this.setCurrentSearchQuery(''); \r\n        await this.fetchProducts();\r\n    }\r\n\r\n    async searchProducts(searchQuery, filters = {}) {\r\n        this.setCurrentSearchQuery(searchQuery);\r\n        \r\n        const finalFilters = { ...this.currentFilters, ...filters };\r\n        if (Object.keys(finalFilters).length > 0) {\r\n            this.setCurrentFilters(finalFilters);\r\n        }\r\n        \r\n        await this.fetchProducts(finalFilters);\r\n    }\r\n\r\n    async changeCity(city) {\r\n        await this.fetchProductsByCity(city);\r\n    }\r\n\r\n    async clearSearch() {\r\n        this.setCurrentSearchQuery('');\r\n        await this.fetchProducts(this.currentFilters || {});\r\n    }\r\n\r\n    async resetFilters() {\r\n        this.setSelectedCity('');\r\n        this.setCurrentSearchQuery('');\r\n        this.clearCurrentFilters();\r\n        sessionStorage.removeItem('city');\r\n        await this.fetchProducts();\r\n    }\r\n\r\n    async applyFilters(filters) {\r\n        this.setCurrentFilters(filters);\r\n        await this.fetchProducts(filters);\r\n    }\r\n\r\n    // НОВЫЕ МЕТОДЫ ДЛЯ РАБОТЫ С ПРОДАВЦАМИ\r\n    async fetchSellers(city = '', page = 1, limit = 12) {\r\n        this.setIsSellersLoading(true);\r\n        try {\r\n            const params = { page, limit };\r\n            if (city) params.city = city;\r\n            \r\n            const response = await getAllSellers(params);\r\n            this.setSellers(response.rows || response);\r\n            this.setSellersTotalCount(response.count || response.length);\r\n            return response;\r\n        } catch (error) {\r\n            console.error('Ошибка при загрузке продавцов:', error);\r\n            this.setError('Не удалось загрузить список магазинов');\r\n            throw error;\r\n        } finally {\r\n            this.setIsSellersLoading(false);\r\n        }\r\n    }\r\n\r\n// store/ProductStore.js\r\nasync fetchSellerById(sellerId) {\r\n    console.log('fetchSellerById called with:', sellerId);\r\n    this.setIsSellersLoading(true);\r\n    try {\r\n        const seller = await getSellerById(sellerId);\r\n        console.log('Seller fetched:', seller);\r\n        this.setSelectedSeller(seller);\r\n        return seller;\r\n    } catch (error) {\r\n        console.error('Ошибка при загрузке продавца:', error);\r\n        console.error('Error details:', error.response);\r\n        this.setError('Не удалось загрузить информацию о магазине');\r\n        throw error;\r\n    } finally {\r\n        this.setIsSellersLoading(false);\r\n    }\r\n}\r\n\r\nasync fetchSellerProducts(sellerId) {\r\n    console.log('fetchSellerProducts called with:', sellerId);\r\n    try {\r\n        const products = await getSellerProducts(sellerId);\r\n        console.log('Seller products fetched:', products);\r\n        this.setSellerProducts(products);\r\n        return products;\r\n    } catch (error) {\r\n        console.error('Ошибка при загрузке товаров продавца:', error);\r\n        \r\n        // Попробуем альтернативный метод\r\n        try {\r\n            console.log('Trying alternative method...');\r\n            const allProducts = await fetchProducts();\r\n            const sellerProducts = allProducts.filter(product => product.seller_id == sellerId);\r\n            console.log('Filtered seller products:', sellerProducts);\r\n            this.setSellerProducts(sellerProducts);\r\n            return sellerProducts;\r\n        } catch (fallbackError) {\r\n            console.error('Fallback method also failed:', fallbackError);\r\n            this.setError('Не удалось загрузить товары магазина');\r\n            throw fallbackError;\r\n        }\r\n    }\r\n}\r\n\r\n    async fetchSellerProducts(sellerId) {\r\n        try {\r\n            const products = await getSellerProducts(sellerId);\r\n            this.setSellerProducts(products);\r\n            return products;\r\n        } catch (error) {\r\n            console.error('Ошибка при загрузке товаров продавца:', error);\r\n            \r\n            // Если отдельный endpoint не работает, используем общий с фильтром\r\n            try {\r\n                const products = await getProductsBySeller(sellerId);\r\n                this.setSellerProducts(products.rows || products);\r\n                return products;\r\n            } catch (fallbackError) {\r\n                this.setError('Не удалось загрузить товары магазина');\r\n                throw fallbackError;\r\n            }\r\n        }\r\n    }\r\n\r\n    async searchSellers(searchQuery) {\r\n        this.setIsSellersLoading(true);\r\n        try {\r\n            // Фильтруем продавцов по имени или описанию\r\n            const allSellers = await getAllSellers();\r\n            const filteredSellers = allSellers.rows?.filter(seller => \r\n                seller.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n                (seller.description && seller.description.toLowerCase().includes(searchQuery.toLowerCase()))\r\n            ) || [];\r\n            \r\n            this.setSellers(filteredSellers);\r\n            return filteredSellers;\r\n        } catch (error) {\r\n            console.error('Ошибка при поиске продавцов:', error);\r\n            throw error;\r\n        } finally {\r\n            this.setIsSellersLoading(false);\r\n        }\r\n    }\r\n\r\n    clearSeller() {\r\n        this.setSelectedSeller(null);\r\n        this.setSellerProducts([]);\r\n    }\r\n\r\n    clearSellers() {\r\n        this.setSellers([]);\r\n        this.setSelectedSeller(null);\r\n        this.setSellerProducts([]);\r\n        this.setSellersPage(1);\r\n    }\r\n}\r\n\r\nexport const productStore = new ProductStore();"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}